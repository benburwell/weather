<!doctype html>
<html>
    <head>
        <title>Weather</title>
        <style type="text/css">
            * {
                margin: 0;
                padding: 0;
            }

            html {
                background-repeat: no-repeat;
                background-size: cover;
                position: absolute;
                background-position: center;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                font-family: "brandon-grotesque", sans-serif;
                font-weight: 100;
                font-size: 20px;
            }

            body {
                width: 100%;
                height: 100%;
            }

            h1 {
                font-size: 2em;
            }

            p {
                font-size: 1em;
            }

            #weather {
                width: 15em;
                height: 15em;
                margin-left: auto;
                margin-right: auto;
                margin-top: 50px;
                color: #fff;
                text-align: center;
                padding: 1em;
                background-color: rgba(30, 30, 30, 0.3);
                vertical-align: middle;
            }

            #temp {
                font-size: 5em;
            }

            #description {
                font-size: 2em;
                padding-bottom: 0.5em;
            }

            .data {
                display: none;
            }

            .error {
                display: none;
            }

            .csspinner {
                position: relative;
            }

            .csspinner:after {
                z-index: 2;
                content: "";
                height: 40px;
                width: 40px;
                position: absolute;
                top: 50%;
                left: 50%;
                margin: -20px 0 0 -20px;
                -webkit-transition: all .85s ease 0s;
                transition: all .85s ease 0s;
                border-radius: 100%;
                -webkit-animation: standard .85s infinite linear;
                animation: standard .85s infinite linear;
                -webkit-transform-origin: center;
                -ms-transform-origin: center;
                transform-origin: center;
                border-right: 4px solid transparent;
                border-top: 4px solid transparent;
                border-left: 4px solid transparent;
                border-bottom: 4px solid #fff;
            }

            @-webkit-keyframes standard {
                from {
                    -webkit-transform: rotate(0deg);
                    transform: rotate(0deg);
                }

                to {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }

            @keyframes standard {
                from {
                    -webkit-transform: rotate(0deg);
                    transform: rotate(0deg);
                }

                to {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }

            @media only screen and (max-width: 480px) {
                #weather {
                    margin: 0;
                    width: 100%;
                    height: 100%;
                    padding: 0;
                }
            }

        </style>
        <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="//use.typekit.net/kzg7xdj.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
        <meta rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
        <meta rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
        <meta rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
        <meta rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
        <meta rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
        <meta rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
        <link href="/icon/apple-touch-startup-image-320x460.png" media="(device-width: 320px)" rel="apple-touch-startup-image">
        <link href="/icon/apple-touch-startup-image-640x920.png" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <link href="/icon/apple-touch-startup-image-768x1004.png" media="(device-width: 768px) and (orientation: portrait)" rel="apple-touch-startup-image">
        <link href="/icon/apple-touch-startup-image-748x1024.png" media="(device-width: 768px) and (orientation: landscape)" rel="apple-touch-startup-image">
        <link href="/icon/apple-touch-startup-image-1536x2008.png" media="(device-width: 1536px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <link href="/icon/apple-touch-startup-image-2048x1496.png" media="(device-width: 1536px)  and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    </head>
    <body>
        <script type="text/javascript">
            $(document).ready(function() {

                // pick random background
                var bg = Math.round(Math.random() * 6);
                var bg_uri = 'http://sleepy-wildwood-9417.herokuapp.com/background/' + bg + '.jpg';
                $('html').css('background-image', 'url(' + bg_uri + ')')

                if (navigator.geolocation) {

                    navigator.geolocation.getCurrentPosition(function(pos) {

                        var lat = pos.coords.latitude;
                        var lon = pos.coords.longitude;
                        var uri = 'http://api.openweathermap.org/data/2.5/weather'
                            + '?lat=' + lat
                            + '&lon=' + lon
                            + '&mode=json';

                        $.getJSON(uri, function(weather) {

                            $('#weather').removeClass('csspinner');

                            if (weather.cod === '404' || weather.id === undefined) {
                                $('#error').text('Sorry, weather is not available for your location.');
                                $('.error').fadeIn(300);
                            } else {

                                var temp = Math.round((weather.main.temp - 273.15) * 9 / 5 + 32) + 'ยบ';
                                var humidity = Math.round(weather.main.humidity) + '%';
                                var wind = Math.round(weather.wind.speed) + ' mph';
                                var pressure = Math.round(weather.main.pressure) + ' hPa';
                                var description = weather.weather[0].main;

                                $('#temp').text(temp);
                                $('#humidity').text(humidity);
                                $('#wind').text(wind);
                                $('#pressure').text(pressure);
                                $('#description').text(description);

                                $('.data').fadeIn(300);
                            }
                        });
                    }, function() {
                        $('#weather').removeClass('csspinner');
                        $('#error').text('Sorry, there was an problem retrieving your location.');
                        $('.error').fadeIn(300);
                    });
                } else {
                    $('#weather').removeClass('csspinner');
                    $('#error').text('Sorry, your browser does not support geolocation.');
                    $('.error').fadeIn(300);
                }
            });
        </script>

        <div id="weather" class="csspinner">
            <div class="error">
                <h1>Error</h1>
                <p id="error"></p>
            </div>
            <p id="temp" class="data"></p>
            <p id="description" class="data"></p>
            <p class="data">
                <span id="humidity" class="data"></span> &bull;
                <span id="wind" class="data"></span> &bull;
                <span id="pressure" class="data"></span>
            </p>
        </div>

    </body>
</html>
